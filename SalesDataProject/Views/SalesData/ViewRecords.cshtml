@model SalesDataProject.Models.UploadResultViewModel


<div class="header d-flex justify-content-between">
    <h2>Sales Data Upload </h2>
    <div class="buttons d-flex gap-2">
        <form asp-action="UploadSalesData" method="post" enctype="multipart/form-data" id="uploadForm">
            <input type="file" id="fileUpload" name="file" class="form-control-file" required style="display: none;" />
            <button type="button" id="uploadButton" class="btn btn-success ml-4 mb-4">Upload Excel </button>
        </form>
        <form asp-action="DownloadTemplate" method="get">
            <button type="submit" class="btn btn-success">Download Template</button>
        </form>
    </div>
</div>
<div class="container mt-5">
    <h2 class="text-center mb-4">Records</h2>
    <div class="card shadow-sm p-4">
        <form asp-action="ViewRecord" method="post">
            <div class="row g-3">
                <div class="col-md-5">
                    <div class="form-group">
                        <label for="SelectedDate" class="form-label">Select Date:</label>
                        <input asp-for="SelectedDate" class="form-control form-control-sm" type="date" placeholder="Choose a date" onfocus="this.showPicker()" />
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group position-relative">
                        <label for="RecordType" class="form-label">Select Record Type:</label>
                        <select asp-for="RecordType" class="form-select form-control-sm">
                            <option value="">-- Select --</option>
                            <option value="Blocked">Blocked</option>
                            <option value="Clean">Clean</option>
                        </select>
                        @* <i class="bi bi-caret-down-fill position-absolute" style="right: 10px; bottom: 18px;"></i> *@
                    </div>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary btn-block w-100">
                        <i class="bi bi-filter"></i> Search
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>






@if (Model.RecordType == "Blocked" && Model.blockCustomer.Any())
{
    <h4>Blocked Customers</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Customer Code</th>
                <th>Customer Name</th>
                <th>Email</th>
                <th>Contact Number</th>
                <th>Blocked Date</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var customer in Model.blockCustomer)
            {
                <tr>
                    <td>@customer.CUSTOMER_CODE</td>
                    <td>@customer.CUSTOMER_NAME</td>
                    <td>@customer.CUSTOMER_EMAIL</td>
                    <td>@customer.CUSTOMER_CONTACT_NUMBER</td>
                    <td>@customer.BlockedDate.ToShortDateString()</td>
                </tr>
            }
        </tbody>
    </table>
}
else if (Model.RecordType == "Clean" && Model.CleanCustomers.Any())
{
    <h4>Clean Customers</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Customer Code</th>
                <th>Customer Name</th>
                <th>Email</th>
                <th>Contact Number</th>
                <th>Creation Date</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var customer in Model.CleanCustomers)
            {
                <tr>
                    <td>@customer.CUSTOMER_CODE</td>
                    <td>@customer.CUSTOMER_NAME</td>
                    <td>@customer.CUSTOMER_EMAIL</td>
                    <td>@customer.CUSTOMER_CONTACT_NUMBER</td>
                    <td>@customer.CREATED_ON.ToShortDateString()</td>
                </tr>
            }

        </tbody>
    </table>
}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the button and input elements
        const uploadButton = document.getElementById('uploadButton');
        const fileUpload = document.getElementById('fileUpload');
        const uploadForm = document.getElementById('uploadForm');

        // Check if the elements exist to avoid null errors
        if (uploadButton && fileUpload && uploadForm) {
            // Trigger the file input when the button is clicked
            uploadButton.addEventListener('click', function () {
                fileUpload.click();
            });

            // Automatically submit the form when a file is selected
            fileUpload.addEventListener('change', function () {
                if (fileUpload.files.length > 0) {
                    uploadForm.submit();
                }
            });
        }
    });
</script>